<app-data-loader *ngIf="loading | async"></app-data-loader>
<div class="content-wrapper reefer-bg" data-widget="main-content">
  <div class="container-fluid">
    <!-- Content Header (Page header) -->
    <div class="content-header">
      <div class="row page-header" id="stickyHeader">
        <div class="col-md-4 col-12">
          <h1 class="m-0">Manage {{ ServiceType }} Service ({{ tabActive }})</h1>
        </div>
        <!-- /.col -->
        <div class="col-md-8 col-12 text-right"></div>
        <!-- /.col -->
      </div>
    </div>
    <!-- Page Content -->
    <div class="row m-0">
      <div class="col-12">
        <ul class="nav nav-tabs" role="tablist" *ngIf="!ServiceType">
          <li class="nav-item">
            <a class="nav-link active" data-toggle="tab" href="#" role="tab"
              >Edit</a
            >
          </li>
          <li class="nav-item">
            <a
              class="nav-link nav-links"
              data-toggle="tab"
              [routerLink]="['/administrator/service']"
              fragment="search"
              role="tab"
              >Search</a
            >
          </li>
        </ul>
        <div class="tab-content">
          <div class="tab-pane active" id="addnew" role="tabpanel">
            <form
              class="form-horizontal row"
              method="post"
              [formGroup]="serviceForm"
              (ngSubmit)="onSubmit()"
            >
              <div class="col-md-12 col-12">
                <div class="form-group row">
                  <div class="col-md-3 mb-10px col-12">
                    <label class="control-label">Service Name*</label>
                    <input
                      type="hidden"
                      formControlName="id_for_edit"
                      [(ngModel)]="serviceData.service_id"
                    />
                    <input
                      type="hidden"
                      formControlName="object_source"
                      name="object_source"
                    />
                    <input readonly="true"
                      type="text"
                      class="form-control custom-form-control"
                      placeholder=""
                      formControlName="service_name"
                      [(ngModel)]="serviceData.service_name"
                      (input)="onFormCheckValid(false)"
                    />
                    <div
                      *ngIf="
                        serviceForm
                          ?.get('service_name')
                          ?.hasError('required') &&
                        serviceForm?.get('service_name')?.touched
                      "
                    >
                      <span class="error-message"
                        >Service Name is required</span
                      >
                    </div>
                  </div>

                  <div class="col-md-3 mb-10px col-12">
                    <label class="control-label">Service Frequency*</label>
                    <input
                      type="text"
                      class="form-control custom-form-control"
                      placeholder=""
                      formControlName="service_frequency"
                      [(ngModel)]="serviceData.service_frequency"
                      readonly
                    />
                    <div
                      *ngIf="
                        serviceForm
                          ?.get('service_frequency')
                          ?.hasError('required') &&
                        serviceForm?.get('service_frequency')?.touched
                      "
                    >
                      <span class="error-message"
                        >Service Frequency is required</span
                      >
                    </div>
                  </div>

                  <div class="col-md-3 mb-10px col-12">
                    <label class="control-label">Performa Frequency*</label>
                    <input
                      type="text"
                      class="form-control custom-form-control"
                      placeholder=""
                      formControlName="Performa_frequency"
                      maxlength="2"
                      [(ngModel)]="serviceData.performa_frequency"
                      (input)="onFormCheckValid(false)"
                    />
                    <div
                      *ngIf="
                        serviceForm
                          ?.get('Performa_frequency')
                          ?.hasError('required') &&
                        serviceForm?.get('Performa_frequency')?.touched
                      "
                    >
                      <span class="error-message"
                        >Performa Frequency is required</span
                      >
                    </div>
                  </div>

                  <div class="col-md-3 mb-10px col-12">
                    <label class="control-label">Round Voyage Date Difference</label>
                    <input type="text" class="form-control custom-form-control" placeholder="" value="{{totalNumberOfDays}}" readonly />
                  </div>
                  
                  <div class="col-md-3 mb-10px col-12">
                    <label class="control-label"
                      >Round Voyage Start Date*</label
                    >
                    <mat-form-field>
                      <input
                        matInput
                        (input)="setToDateMin()"
                        (dateChange)="dateValueChanged()"
                        [readonly]="true"
                        [matDatepicker]="picker2"
                        formControlName="round_voyage_start_date"
                        [(ngModel)]="serviceData.service_start_date_current"
                        class="form-control custom-form-control"
                        (input)="onFormCheckValid(false)"
                      />
                      <mat-datepicker-toggle
                        matSuffix
                        [for]="picker2"
                      ></mat-datepicker-toggle>
                      <mat-datepicker #picker2></mat-datepicker>
                    </mat-form-field>
                    <div
                      *ngIf="
                        serviceForm
                          ?.get('round_voyage_start_date')
                          ?.hasError('required') &&
                        serviceForm?.get('round_voyage_start_date')?.touched
                      "
                    >
                      <span class="error-message"
                        >Round Voyage Start Date is required</span
                      >
                    </div>
                  </div>

                  <div class="col-md-3 mb-10px col-12">
                    <label class="control-label">Round Voyage End Date*</label>
                    <mat-form-field>
                      <input
                        matInput
                        [min]="
                          serviceForm.get('round_voyage_start_date')?.value
                        "
                        (dateChange)="dateValueChanged()"
                        [readonly]="true"
                        [matDatepicker]="picker1"
                        formControlName="round_voyage_end_date"
                        [(ngModel)]="serviceData.service_end_date_current"
                        class="form-control custom-form-control"
                        (input)="onFormCheckValid(false)"
                      />
                      <mat-datepicker-toggle
                        matSuffix
                        [for]="picker1"
                      ></mat-datepicker-toggle>
                      <mat-datepicker #picker1></mat-datepicker>
                    </mat-form-field>
                    <div
                      *ngIf="
                        serviceForm
                          ?.get('round_voyage_end_date')
                          ?.hasError('required') &&
                        serviceForm?.get('round_voyage_end_date')?.touched
                      "
                    >
                      <span class="error-message"
                        >Round Voyage End Date is required</span
                      >
                    </div>
                  </div>

                  <div class="col-md-3 mb-10px col-12">
                    <label class="control-label">Alliance</label>
                    <select
                      class="form-control custom-form-control"
                      name="alliance"
                      id="alliance_id"
                      formControlName="alliance"
                      [(ngModel)]="
                        serviceData.serviceAlliance.ServiceAllianceArray
                          .alliance_id
                      "
                      (change)="handleAllianceChange($event)"
                    >
                      <option value="0">Select</option>
                      <option
                        *ngFor="let alliance of allianceList"
                        [value]="alliance.alliance_id"
                      >
                        {{ alliance.alliance_name }}
                      </option>
                    </select>
                  </div>

                  <div class="col-md-3 mb-10px col-12">
                    <label class="control-label">Service Code*</label>
                    <input
                      type="text"
                      class="form-control custom-form-control"
                      placeholder=""
                      formControlName="service_code"
                      [(ngModel)]="serviceData.service_code"
                      (input)="onFormCheckValid(false)"
                      (keyup)="serviceCodeChange()"
                    />
                    <div
                      *ngIf="
                        serviceForm
                          ?.get('service_code')
                          ?.hasError('required') &&
                        serviceForm?.get('service_code')?.touched
                      "
                    >
                      <span class="error-message"
                        >Service Code is required</span
                      >
                    </div>
                  </div>

                  <div class="col-md-3 mb-10px col-12">
                    <label class="control-label">Service Start Date*</label>
                    <mat-form-field>
                      <input
                        matInput
                        id="targetdate"
                        [readonly]="true"
                        [matDatepicker]="picker3"
                        formControlName="service_start_date"
                        [(ngModel)]="serviceData.starting_date_attribute"
                        class="form-control custom-form-control"
                        (input)="onFormCheckValid(false)"
                      />
                      <mat-datepicker-toggle
                        matSuffix
                        [for]="picker3"
                      ></mat-datepicker-toggle>
                      <mat-datepicker #picker3></mat-datepicker>
                    </mat-form-field>
                    <div
                      *ngIf="
                        serviceForm
                          ?.get('service_start_date')
                          ?.hasError('required') &&
                        serviceForm?.get('service_start_date')?.touched
                      "
                    >
                      <span class="error-message"
                        >Service Start Date is required</span
                      >
                    </div>
                  </div>

                  <div class="col-md-3 mb-10px col-12">
                    <label class="control-label">Drewry Reference Code *</label>
                    <div class="position-relative">
                      <input
                        type="text"
                        class="form-control custom-form-control"
                        readonly
                        formControlName="drewry_reference"
                        [(ngModel)]="serviceData.service_drewry_reference_name"
                      />
                    </div>
                    <!-- <span class="spincode">
                                            <a class="getrcdcode" (click)="createRcdCode()">Get RCD Code
                                                <i *ngIf="rcdshow" class="fa fa-spinner fa-spin"></i>
                                            </a>
                                        </span> -->
                    <div
                      *ngIf="
                        serviceForm
                          ?.get('drewry_reference')
                          ?.hasError('required') &&
                        serviceForm?.get('drewry_reference')?.touched
                      "
                    >
                      <span class="error-message"
                        >Drewry Reference is required</span
                      >
                    </div>
                    <div
                      *ngIf="
                        serviceForm
                          ?.get('drewry_reference')
                          ?.hasError('minlength') &&
                        serviceForm?.get('drewry_reference')?.touched
                      "
                    >
                      <span class="error-message"
                        >Drewry Reference minimum 6 character/digits long</span
                      >
                    </div>
                  </div>

                  <div class="col-md-3 mb-10px col-12">
                    <label class="control-label">Service Status*</label>
                    <select
                      class="form-control custom-form-control"
                      name="service_status"
                      id="service_status_id"
                      formControlName="service_status"
                      [(ngModel)]="serviceData.service_status"
                      [innerHTML]="serviceStatusList"
                      (change)="onFormCheckValid(false)"
                    ></select>
                    <div
                      *ngIf="
                        serviceForm
                          ?.get('service_status')
                          ?.hasError('required') &&
                        serviceForm?.get('service_status')?.touched
                      "
                    >
                      <span class="error-message"
                        >Service Status is required</span
                      >
                    </div>
                  </div>

                  <div class="col-md-3 mb-10px col-12">
                    <label class="control-label">Service Type*</label>
                    <select
                      class="form-control custom-form-control"
                      name="service_type"
                      id="service_type_id"
                      formControlName="service_type"
                      [(ngModel)]="serviceData.service_type"
                      (change)="onFormCheckValid(false)"
                    >
                      <option value="">Select</option>
                      <option
                        *ngFor="let servicetype of serviceTypeList"
                        [value]="servicetype.service_type_id"
                      >
                        {{ servicetype.service_type_name }}
                      </option>
                    </select>
                    <div
                      *ngIf="
                        serviceForm
                          ?.get('service_type')
                          ?.hasError('required') &&
                        serviceForm?.get('service_type')?.touched
                      "
                    >
                      <span class="error-message"
                        >Service Type is required</span
                      >
                    </div>
                  </div>

                  <div class="col-md-3 mb-10px col-12">
                    <label class="control-label">Routing</label>
                    <select
                      class="form-control custom-form-control"
                      name="canal"
                      id="canal_id"
                      formControlName="canal_id"
                      [(ngModel)]="serviceData.canal_id"
                    >
                      <option value="0">Select</option>
                      <option
                        *ngFor="let routing of routingList"
                        [value]="routing.canal_id"
                      >
                        {{ routing.canal_name }}
                      </option>
                    </select>
                  </div>
                <div class="col-md-12 mb-10px col-12">
                  <div class ="row">
                  <div class="col-md-6 mb-10px col-12">
                    <label class="control-label">Remarks*</label>
                    <textarea
                      class="form-control custom-form-control"
                      placeholder=""
                      formControlName="remarks"
                      [(ngModel)]="serviceData.service_remarks"
                      (keyup)="onFormCheckValid(false)"
                    ></textarea>
                    <div
                      *ngIf="
                        serviceForm?.get('remarks')?.hasError('required') &&
                        serviceForm?.get('remarks')?.touched
                      "
                    >
                      <span class="error-message">Remarks is required</span>
                    </div>
                  </div>

                  <div class="col-md-6 mb-10px col-12">
                    <label class="control-label">Wayport % Comments</label>
                    <textarea
                      class="form-control custom-form-control"
                      placeholder=""
                      formControlName="wayport_comments"
                      [(ngModel)]="serviceData.wayport_comments"
                    ></textarea>
                  </div>
                </div>
                </div>
                </div>
              </div>
              <div class="col-12 mb-4">
                <div class="form-group">
                  <button
                    class="btn btn-yellow text-uppercase fw-bold mr-2"
                    (click)="onFormCheckValid()"
                    type="button"
                    [class.addValidButton]="topform === 'valid'"
                  >
                    VALIDATE
                  </button>
                  <button
                    class="btn btn-yellow text-uppercase fw-bold"
                    (click)="resetForm()"
                    type="button"
                  >
                    Reset
                  </button>
                </div>
              </div>
              <div class="col-lg-12 mb-3">
                <ul class="nav nav-tabs" role="tablist">
                  <li class="nav-item">
                    <a
                      class="nav-link active"
                      data-toggle="tab"
                      href="#trade_routes"
                      role="tab"
                      >Service Port / Trade Routes</a
                    >
                  </li>
                  <li class="nav-item">
                    <a
                      class="nav-link"
                      data-toggle="tab"
                      href="#aliases"
                      role="tab"
                      >Service aliases / Vessels</a
                    >
                  </li>
                </ul>
              </div>
              <div class="col-lg-12 dark-fields">
                <div class="tab-content panel panel-white">
                  <div
                    class="tab-pane active"
                    id="trade_routes"
                    role="tabpanel"
                  >
                    <table class="table" formArrayName="servicePort">
                      <thead>
                        <tr>
                          <th>Port</th>
                          <th>Arrival Days</th>
                          <th>Departure Days</th>
                          <th>Arrival Day</th>
                          <th>Departure Day</th>
                          <th>Action</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr
                          *ngFor="
                            let portService of servicePort().controls;
                            let i = index
                          "
                          [formGroupName]="i" class="port-multiselect" 
                        >
                          <td>
                            <ng-multiselect-dropdown
                              placeholder="Port"
                              formControlName="port"
                              (onSelect)="onItemSelect(i)"
                              (onDeSelect)="onItemDeSelect(i)"
                              class="form-control custom-form-control custom-accordion"
                              [settings]="regionToTagsSettings"
                              [data]="port"
                            >
                            </ng-multiselect-dropdown>
                            <input
                              type="hidden"
                              formControlName="port_up"
                              name="port_up"
                            />
                            <div
                              class="text-danger"
                              *ngIf="
                                portService
                                  ?.get('port')
                                  ?.hasError('required') &&
                                portService?.get('port')?.touched
                              "
                            >
                              Port is required.
                            </div>
                          </td>
                          <td>
                            <input
                              type="text"
                              class="form-control custom-form-control"
                              name="arrival_days"
                              formControlName="arrival_days"
                              (input)="onInput($event, i, 'arrival_days'); onServicePortChange()"
                            />
                            <div
                              class="text-danger"
                              *ngIf="
                                portService
                                  ?.get('arrival_days')
                                  ?.hasError('required') &&
                                portService?.get('arrival_days')?.touched
                              "
                            >
                              Arrival Days is required.
                            </div>
                            <div
                              *ngIf="
                                portService
                                  .get('arrival_days')
                                  ?.hasError('invalidArrivalDays') &&
                                errorDetails[i] != false
                              "
                            >
                              <div class="text-danger">
                                Service Round Voyage Days ({{
                                  errorDetails[i].totalNumberOfDays
                                }}) and Port Maximum Arrival Days ({{
                                  errorDetails[i].days
                                }}) Should be Equal!
                              </div>
                            </div>
                          </td>
                          <td>
                            <input
                              type="text"
                              class="form-control custom-form-control"
                              name="departure_days"
                              formControlName="departure_days"
                              (input)="onInput($event, i, 'departure_days')"
                            />
                            <div
                              class="text-danger"
                              *ngIf="
                                portService
                                  ?.get('departure_days')
                                  ?.hasError('required') &&
                                portService?.get('departure_days')?.touched
                              "
                            >
                              Departure Days is required.
                            </div>
                            <div
                              *ngIf="
                                portService
                                  .get('departure_days')
                                  ?.hasError('invalidDepartureDays')
                              "
                            >
                              <div class="text-danger">
                                Port Departure Days Can not be less than port
                                arrival days
                              </div>
                            </div>
                          </td>
                          <td>
                            <select
                              class="form-control custom-form-control"
                              name="arrival_day"
                              id="arrival_day"
                              formControlName="arrival_day"
                            >
                              <option value="">Select</option>
                              <option
                                *ngFor="let day of weekdays"
                                [value]="day"
                              >
                                {{ day }}
                              </option>
                            </select>
                            <div
                              class="text-danger"
                              *ngIf="
                                portService
                                  ?.get('arrival_day')
                                  ?.hasError('required') &&
                                portService?.get('arrival_day')?.touched
                              "
                            >
                              Arrival Day is required.
                            </div>
                          </td>
                          <td>
                            <select
                              class="form-control custom-form-control"
                              name="departure_day"
                              id="departure_day"
                              formControlName="departure_day"
                            >
                              <option value="">Select</option>
                              <option
                                *ngFor="let day of weekdays"
                                [value]="day"
                              >
                                {{ day }}
                              </option>
                            </select>
                            <div
                              class="text-danger"
                              *ngIf="
                                portService
                                  ?.get('departure_day')
                                  ?.hasError('required') &&
                                portService?.get('departure_day')?.touched
                              "
                            >
                              Departure Days is required.
                            </div>
                          </td>
                          <td>
                            <i
                              *ngIf="servicePort().controls.length > 1"
                              class="fa fa-trash removerow"
                              aria-hidden="true"
                              (click)="removePort(i)"
                            ></i>
                          </td>
                        </tr>
                        <tr>
                          <td colspan="5" class="pt-0 pb-0">
                            <div class="firstlastPort">
                              <div *ngIf="lastPort">
                                <span class="error-message"
                                  >First and Last ports arrival and departure
                                  days differance should be same.
                                </span>
                              </div>
                            </div>
                          </td>
                        </tr>
                      </tbody>
                    </table>
                    <div class="col-12 mb-4">
                      <div class="form-group">
                        <button
                          class="btn btn-yellow text-uppercase fw-semibold mr-2"
                          type="button"
                          (click)="addPort()"
                        >
                          Add
                        </button>
                      </div>
                    </div>
                    <table
                      class="table table-striped dynamic-table"
                      *ngIf="tradeRouteList && tradeRouteList.length > 0"
                      formArrayName="tradeService"
                    >
                      <thead>
                        <tr>
                          <th>Primary</th>
                          <th>Trade Route Name</th>
                          <th>Valid</th>
                          <th>Way Port %</th>
                          <th>Out of Scope %</th>
                          <th>Dwt Adjustment %</th>
                          <th>High Cube Adjustment %</th>
                          <th>Vessel Deployment File</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr
                          *ngFor="
                            let tradeRoute of tradeRouteList;
                            let i = index
                          "
                          [formGroupName]="i"
                        >
                          <td>
                            <input
                              type="checkbox"
                              formControlName="service_primary_trade_route"
                              (change)="onCheckboxChange(i)"
                            />
                            <input
                              name="service_trade_route_name"
                              formControlName="service_trade_route_name"
                              type="hidden"
                            />
                            <input
                              name="service_trade_route"
                              formControlName="service_trade_route"
                              type="hidden"
                            />
                          </td>
                          <td>
                            {{ tradeRoute.trade_route_name }}
                          </td>
                          <td>
                            <select
                              class="form-control"
                              formControlName="valid"
                            >
                              <option value="">Select</option>
                              <option value="Yes">Y</option>
                              <option value="No">N</option>
                            </select>
                          </td>
                          <td>
                            <input
                              type="text"
                              formControlName="way_port"
                              (keyup)="onKeyUp($event)"
                              class="form-control custom-form-control"
                            />
                          </td>
                          <td>
                            <input
                              type="text"
                              formControlName="out_of_scope"
                              class="form-control custom-form-control"
                              readonly
                            />
                          </td>
                          <td>
                            <input
                              type="text"
                              formControlName="dwt_adjustment"
                              class="form-control custom-form-control"
                              readonly
                            />
                          </td>
                          <td>
                            <input
                              type="text"
                              formControlName="high_cube_adjustment"
                              class="form-control custom-form-control"
                              readonly
                            />
                          </td>
                          <td>
                            <input
                              type="checkbox"
                              formControlName="vessel_deployment_flag"
                            />
                          </td>
                        </tr>
                      </tbody>
                    </table>
                    <div class="col-12 mb-4">
                      <div class="form-group">
                        <button
                          class="btn btn-yellow text-uppercase fw-semibold mr-2"
                          type="button"
                          (click)="servicePostValid()"
                          [class.addValidButton]="portServiceform === 'valid'"
                        >
                          Validate
                        </button>
                        <button
                          class="btn btn-yellow text-uppercase fw-bold"
                          type="button"
                          (click)="resetPortForm()"
                        >
                          Reset
                        </button>
                      </div>
                    </div>
                  </div>
                    <div class="tab-pane" id="aliases" role="tabpanel">
                      <table class="table" formArrayName="serviceAlias">
                        <thead>
                          <tr>
                            <th>Operator</th>
                            <th>Alias Name</th>
                            <th>Schedule Hyperlink</th>
                            <th>Action</th>
                          </tr>
                        </thead>
                        <tbody>
                          <tr
                            *ngFor="
                              let alias of serviceAlias().controls;
                              let ii = index
                            "
                            [formGroupName]="ii"
                          >
                            <td>
                              <ng-multiselect-dropdown
                                placeholder="Operator"
                                formControlName="operator"
                                class="form-control custom-form-control custom-accordion"
                                [settings]="operatorTagsSettings"
                                [data]="operator"
                              >
                              </ng-multiselect-dropdown>
                              <div
                                class="text-danger"
                                *ngIf="
                                  alias?.get('operator')?.hasError('required') &&
                                  alias?.get('operator')?.touched
                                "
                              >
                                Operator Name is required.
                              </div>
                            </td>
                            <td>
                              <input
                                type="text"
                                class="form-control custom-form-control"
                                placeholder=""
                                formControlName="alias_name"
                                (input)="serviceVesselValid(false); onServiceAliasChange()"
                              />
                              <div
                                class="text-danger"
                                *ngIf="
                                  alias
                                    ?.get('alias_name')
                                    ?.hasError('required') &&
                                  alias?.get('alias_name')?.touched
                                "
                              >
                                Alias Name is required.
                              </div>
                            </td>
                            <td>
                              <input
                                type="text"
                                class="form-control custom-form-control"
                                placeholder=""
                                formControlName="schedule_hyperlink"
                              />
                            </td>
                            <td>
                              <i
                                *ngIf="serviceAlias().controls.length > 1"
                                class="fa fa-trash removerow"
                                aria-hidden="true"
                                (click)="removeAlias(ii)"
                              ></i>
                            </td>
                          </tr>
                        </tbody>
                      </table>
                      <div class="col-12 mb-4">
                        <div class="form-group">
                          <button
                            class="btn btn-yellow text-uppercase fw-semibold mr-2"
                            type="button"
                            (click)="addAlias()"
                          >
                            Add alias
                          </button>
                        </div>
                      </div>
  
                      <table class="table" formArrayName="serviceVessel">
                        <thead>
                          <tr>
                            <th>Vessel Name</th>
                            <th>Teu Capacity</th>
                            <th>Operator</th>
                            <th>Ownership Status</th>
                            <th>Move To</th>
                          </tr>
                        </thead>
                        <tbody>
                          <tr
                            *ngFor="
                              let isserviceVessel of serviceVessel().controls;
                              let iii = index
                            "
                            [formGroupName]="iii"
                          >
                            <td>
                              <input
                                type="hidden"
                                class="form-control custom-form-control vessel_operator"
                                placeholder=""
                                formControlName="vessel"
                                readonly
                              />
                              <input
                                type="text"
                                class="form-control custom-form-control vessel_operator"
                                placeholder=""
                                formControlName="vessel"
                                *ngIf="
                                  isserviceVessel?.get('addedInput')?.value ==
                                  'select'
                                "
                                readonly
                              />
                              <ng-multiselect-dropdown
                                placeholder="Vessel"
                                formControlName="vessel_name"
                                *ngIf="
                                  isserviceVessel?.get('addedInput')?.value !=
                                  'select'
                                "
                                (onSelect)="onItemVessel(iii)"
                                (ngModelChange)="onServiceVesselChange()"
                                (onDeSelect)="onItemVessel(iii)"
                                class="form-control custom-form-control custom-accordion"
                                [settings]="vesselTagsSettings"
                                [data]="vessel"
                                (onFilterChange)="onFilterVesselChange($event)"
                              >
                              </ng-multiselect-dropdown>
  
                              <div
                                class="text-danger"
                                *ngIf="
                                  isserviceVessel
                                    ?.get('vessel_name')
                                    ?.hasError('required') &&
                                  isserviceVessel?.get('vessel_name')?.touched
                                "
                              >
                                Vessel Name is required.
                              </div>
                            </td>
                            <td>
                              <input
                                type="text"
                                class="form-control custom-form-control"
                                placeholder=""
                                formControlName="teu_capacity"
                                readonly
                              />
                            </td>
                            <td>
                              <input
                                type="text"
                                class="form-control custom-form-control"
                                *ngIf="
                                  isserviceVessel.get('addedInput')?.value !=
                                  'select'
                                "
                                formControlName="vessel_operator"
                                readonly
                              />
                              <select
                                *ngIf="
                                  isserviceVessel.get('addedInput')?.value ==
                                  'select'
                                "
                                formControlName="vessel_operator"
                                class="form-control custom-form-control"
                              >
                                <option value="Unknown">Unknown</option>
                                <option *ngFor="let vesselOperator of selectVesselOperators" [value]="vesselOperator">
                                  {{ vesselOperator }}
                                </option>
                              </select>
                            </td>
                            <td>
                              <input
                                type="text"
                                class="form-control custom-form-control"
                                placeholder=""
                                formControlName="ownership_status"
                                readonly
                              />
                            </td>
                            <td>
                              <select
                                formControlName="move_to_service"
                                class="form-control custom-form-control"
                              >
                                <option value="">Select</option>
                                <option
                                  *ngFor="let moveto of movetoList"
                                  [value]="moveto.current_service_id"
                                >
                                  {{ moveto.service_name }}
                                </option>
                              </select>
                            </td>
                            <td>
                              <i
                                *ngIf="serviceVessel().controls.length > 1"
                                class="fa fa-trash removerow"
                                aria-hidden="true"
                                (click)="removeVessel(iii)"
                              ></i>
                            </td>
                          </tr>
                          <tr *ngIf="isDuplicate">
                            <td class="pt-0 pb-0" colspan="5">
                              <div>
                                <span class="error-message">
                                  Duplicate entry found for vessel Name.</span
                                >
                              </div>
                            </td>
                          </tr>
                        </tbody>
                      </table>
  
                      <div class="col-12 mb-4">
                        <div class="form-group forbtn">
                          <button
                            class="btn btn-yellow text-uppercase fw-bold mr-2"
                            type="button"
                            (click)="addVessel(); onServiceVesselChange()"
                          >
                            Add Vessel
                          </button>
                          <button
                            class="btn btn-yellow text-uppercase fw-bold mr-2"
                            (click)="missedVoyage(); onServiceVesselChange()"
                            type="button"
                          >
                            Add Missed Voyage
                          </button>
                          <button
                            class="btn btn-yellow text-uppercase fw-bold mr-2"
                            (click)="addVesselTBN(); onServiceVesselChange()"
                            type="button"
                          >
                            Add TBN
                          </button>
                          <button
                            class="btn btn-yellow text-uppercase fw-bold"
                            type="button"
                            (click)="phasedOut(); onServiceVesselChange()"
                          >
                            Add Phased Out
                          </button>
                        </div>
                      </div>
  
                      <div class="col-12 mb-4">
                        <div class="form-group">
                          <button
                            class="btn btn-yellow text-uppercase fw-semibold mr-2"
                            type="button"
                            (click)="serviceVesselValid()"
                            [class.addValidButton]="vesselForm === 'valid'"
                          >
                            Validate
                          </button>
                          <button
                            class="btn btn-yellow text-uppercase fw-bold"
                            type="button"
                            (click)="resetVesselForm()"
                          >
                            Reset
                          </button>
                        </div>
                      </div>
                    </div>
                  <div
                    class="col-12 mb-4"
                    *ngIf="
                      topform == 'valid' &&
                      portServiceform == 'valid' &&
                      vesselForm == 'valid'
                    "
                  >
                    <hr />
                    <div class="form-group">
                      <button
                        class="btn btn-yellow text-uppercase fw-semibold mr-2"
                        type="submit"
                      >
                        Save
                      </button>
                      <button
                        class="btn btn-yellow text-uppercase fw-bold"
                        type="button"
                        (click)="resetAllForm()"
                      >
                        Reset
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
    <app-footer></app-footer>
  </div>
</div>

<!-- Shift Modal End -->
<div
  id="myModal"
  class="modal fade editModal service-view"
  tabindex="-1"
  role="dialog"
  data-backdrop="static"
>
  <form
    class="form-horizontal row"
    method="post"
    [formGroup]="serviceDataForm"
    (ngSubmit)="onSaveData()"
  >
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Edit {{ ServiceType }} Service View</h5>
          <button type="button" class="close" (click)="closeModal()">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body" *ngFor="let serviceObject of serviceViewObject">
          <div class="col-12 mt-2">
            <input
              type="hidden"
              formControlName="sendServiceObject"
              [(ngModel)]="serializeData"
            />
            <input
              type="hidden"
              formControlName="newVessel"
              [(ngModel)]="newVessels"
            />
            <div class="panel panel-white h-100 service-classification-table">
              <div class="panel-body table-responsive pt-3">
                <table class="table" align="left" id="add_class_box">
                  <tbody>
                    <tr>
                      <td align="right">
                        <label>Service Name:</label>
                        <input
                          type="hidden"
                          formControlName="service_name"
                          [(ngModel)]="serviceObject.service_name"
                        />
                      </td>
                      <td class="fieldbox">
                        <b
                          >{{ serviceObject.service_name }}
                          <a>
                            <img
                              width="25"
                              src="../assets/images/news_icon.png"
                              title="News"
                            />
                          </a>
                        </b>
                      </td>
                      <td align="right">
                        <label>Service Frequency:</label>
                      </td>
                      <td class="fieldbox">
                        <b>{{ serviceObject.service_frequency }}</b>
                      </td>
                    </tr>
                    <tr>
                      <td align="right">
                        <label>Round Voyage Start Date:</label>
                      </td>
                      <td class="fieldbox">
                        <b>{{ serviceObject.service_start_date_current }}</b>
                      </td>
                      <td align="right">
                        <label>Round Voyage End Date:</label>
                      </td>
                      <td class="fieldbox">
                        <b>{{ serviceObject.service_end_date_current }}</b>
                      </td>
                    </tr>
                    <tr>
                      <td align="right">
                        <label>Service Alliance:</label>
                      </td>
                      <td class="fieldbox">
                        <b>
                          {{ serviceObject.allianceArray[0].alliance_name }}
                          <input
                            type="hidden"
                            formControlName="alliance"
                            [(ngModel)]="
                              serviceObject.allianceArray[0].alliance_id
                            "
                          />
                        </b>
                      </td>
                      <td align="right">
                        <label>Service Code:</label>
                      </td>
                      <td class="fieldbox">
                        <b>{{ serviceObject.service_code }}</b>
                      </td>
                    </tr>
                    <tr>
                      <td align="right">
                        <label>Service Starting Date:</label>
                      </td>
                      <td class="fieldbox">
                        <b>{{ serviceObject.starting_date_attribute }}</b>
                      </td>
                      <td align="right">
                        <label>Service End Date:</label>
                      </td>
                      <td class="fieldbox">
                        <b></b>
                      </td>
                    </tr>
                    <tr>
                      <td align="right">
                        <label>Drewry Reference Code:</label>
                      </td>
                      <td class="fieldbox">
                        <b>{{ serviceObject.service_drewry_reference_name }}</b>
                      </td>
                      <td align="right">
                        <label>Service Status:</label>
                      </td>
                      <td class="fieldbox">
                        <b>{{ serviceObject.service_status_name }}</b>
                      </td>
                    </tr>
                    <tr>
                      <td align="right">
                        <label>Service Type:</label>
                      </td>
                      <td class="fieldbox">
                        <b>{{ serviceObject.service_type_name }}</b>
                      </td>
                      <td align="right">
                        <label>Service Routing:</label>
                      </td>
                      <td class="fieldbox">
                        <b>{{ serviceObject.canal_name }}</b>
                      </td>
                    </tr>
                    <tr>
                      <td align="right">
                        <label>Total Vessel:</label>
                      </td>
                      <td class="fieldbox">
                        <input
                          type="hidden"
                          formControlName="total_vessel"
                          [(ngModel)]="
                            serviceObject.serviceVessels.total_vessels
                          "
                        />
                        <b>{{ serviceObject.serviceVessels.total_vessels }}</b>
                      </td>
                      <td align="right">
                        <label>Active Vessel:</label>
                      </td>
                      <td class="fieldbox">
                        <input
                          type="hidden"
                          formControlName="active_vessel"
                          [(ngModel)]="
                            serviceObject.serviceVessels.no_of_active_vessels
                          "
                        />
                        <b>{{
                          serviceObject.serviceVessels.no_of_active_vessels
                        }}</b>
                      </td>
                    </tr>
                    <tr>
                      <td align="right">
                        <label>Missed Vessel:</label>
                      </td>
                      <td class="fieldbox">
                        <input
                          type="hidden"
                          formControlName="missed_vessel"
                          [(ngModel)]="
                            serviceObject.serviceVessels.no_of_missed_vessels
                          "
                        />
                        <b>{{
                          serviceObject.serviceVessels.no_of_missed_vessels
                        }}</b>
                      </td>
                      <td align="right">
                        <label>Round Voyage Days:</label>
                      </td>
                      <td class="fieldbox">
                        <input
                          type="hidden"
                          formControlName="round_voyage_days"
                          [(ngModel)]="serviceObject.service_round_voyage_days"
                        />
                        <b>{{ serviceObject.service_round_voyage_days }}</b>
                      </td>
                    </tr>
                    <tr>
                      <td align="right">
                        <label>Average Capacity:</label>
                      </td>
                      <td class="fieldbox">
                        <input
                          type="hidden"
                          formControlName="average_capacity"
                          [(ngModel)]="
                            serviceObject.service_average_vessel_size
                          "
                        />
                        <b>{{ serviceObject.service_average_vessel_size }}</b>
                      </td>
                      <td align="right">
                        <label>Remarks:</label>
                      </td>
                      <td class="fieldbox">
                        <input
                          type="hidden"
                          formControlName="remarks"
                          [(ngModel)]="serviceObject.service_remarks"
                        />
                        <b>{{ serviceObject.service_remarks }}</b>
                      </td>
                    </tr>
                    <tr>
                      <td align="right">Performa Frequencty:</td>
                      <td class="fieldbox">
                        <input
                          type="hidden"
                          formControlName="performa_frequency"
                          [(ngModel)]="serviceObject.performa_frequency"
                        />
                        <b>{{ serviceObject.performa_frequency }}</b>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
          <div class="col-12 mt-2">
            <div class="panel panel-white h-100 service-classification-table">
              <div class="panel-heading d-inline-block float-left">
                Service Ports
              </div>
              <div class="panel-body table-responsive pt-3">
                <table class="table table-striped">
                  <thead>
                    <tr>
                      <th>Port Name</th>
                      <th>Arrival Days</th>
                      <th>Departure Days</th>
                      <th>Arrival Day</th>
                      <th>Departute Day</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr
                      class="table_row_1"
                      *ngFor="
                        let port of serviceObject.servicePorts.ServicePortArray
                      "
                    >
                      <td
                        class="service_name_class"
                        title="Port Departure Days Can not be less than port arrival days;"
                      >
                        {{ port.port_name }}
                      </td>
                      <td>{{ port.arrival_days }}</td>
                      <td>{{ port.departure_days }}</td>
                      <td>{{ port.arrival_day }}</td>
                      <td>{{ port.departure_day }}</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
          <div class="col-12 mt-2">
            <div class="panel panel-white h-100 service-classification-table">
              <div class="panel-heading d-inline-block float-left">
                Service Trade Routes
              </div>
              <div class="panel-body table-responsive pt-3">
                <table class="table table-striped">
                  <thead>
                    <tr>
                      <th>Primary</th>
                      <th>Trade Route Name</th>
                      <th title="123">Way Port Percentage %</th>
                      <th>Out of Scope %</th>
                      <th>Dwt Adjustment %</th>
                      <th>High Cube Adjustment %</th>
                      <th>Vessel Development</th>
                    </tr>
                  </thead>
                  <tbody *ngIf="!year">
                    <tr
                      class="table_row_1"
                      *ngFor="
                        let tradeRoutes of serviceObject.serviceTradeRoutes
                          .ServiceTradeRouteArray
                      "
                    >
                      <td>
                        <div
                          *ngIf="
                            tradeRoutes.current_service_trade_route_id
                              .service_primary_trade_route;
                            else elseBlock
                          "
                        >
                          YES
                        </div>
                        <ng-template #elseBlock> NO </ng-template>
                      </td>
                      <td class="service_name_class" title="">
                        {{
                          tradeRoutes.current_service_trade_route_id
                            .service_trade_route_name
                        }}
                      </td>
                      <td>
                        {{
                          tradeRoutes.current_service_trade_route_id.way_port
                        }}
                      </td>
                      <td>
                        {{
                          tradeRoutes.current_service_trade_route_id
                            .out_of_scope
                        }}
                      </td>
                      <td>
                        {{
                          tradeRoutes.current_service_trade_route_id
                            .dwt_adjustment
                        }}
                      </td>
                      <td>
                        {{
                          tradeRoutes.current_service_trade_route_id
                            .high_cube_adjustment
                        }}
                      </td>
                      <td>
                        <div
                          *ngIf="
                            tradeRoutes.current_service_trade_route_id
                              .vessel_deployment_flag;
                            else elseBlockShow
                          "
                        >
                          YES
                        </div>
                        <ng-template #elseBlockShow> NO </ng-template>
                      </td>
                    </tr>
                  </tbody>
                  <tbody *ngIf="year">
                    <tr
                      class="table_row_1"
                      *ngFor="
                        let tradeRoutes of serviceObject.serviceTradeRoutes
                          .ServiceTradeRouteArray
                      "
                    >
                      <td>
                        <div
                          *ngIf="
                            tradeRoutes.archived_service_trade_route_id
                              .service_primary_trade_route;
                            else elseBlock
                          "
                        >
                          YES
                        </div>
                        <ng-template #elseBlock> NO </ng-template>
                      </td>
                      <td class="service_name_class" title="">
                        {{
                          tradeRoutes.archived_service_trade_route_id
                            .service_trade_route_name
                        }}
                      </td>
                      <td>
                        {{
                          tradeRoutes.archived_service_trade_route_id.way_port
                        }}
                      </td>
                      <td>
                        {{
                          tradeRoutes.archived_service_trade_route_id
                            .out_of_scope
                        }}
                      </td>
                      <td>
                        {{
                          tradeRoutes.archived_service_trade_route_id
                            .dwt_adjustment
                        }}
                      </td>
                      <td>
                        {{
                          tradeRoutes.archived_service_trade_route_id
                            .high_cube_adjustment
                        }}
                      </td>
                      <td>
                        <div
                          *ngIf="
                            tradeRoutes.archived_service_trade_route_id
                              .vessel_deployment_flag;
                            else elseBlockShow
                          "
                        >
                          YES
                        </div>
                        <ng-template #elseBlockShow> NO </ng-template>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
          <div class="col-12 mt-2">
            <div class="panel panel-white h-100 service-classification-table">
              <div class="panel-heading d-inline-block float-left">
                Operator Detail
              </div>
              <div class="panel-body table-responsive pt-3">
                <table class="table table-striped">
                  <thead>
                    <tr>
                      <th>Operator Name</th>
                      <th>Alias Name</th>
                      <th>Schedule Hyperlink</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr
                      class="table_row_1"
                      *ngFor="
                        let aliases of serviceObject.serviceAliases
                          .ServiceAliasArray
                      "
                    >
                      <td>{{ aliases.operator_name }}</td>
                      <td>{{ aliases.alias_name }}</td>
                      <td>{{ aliases.schedule_hyperlink }}</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
          <div class="col-12 mt-2">
            <div class="panel panel-white h-100 service-classification-table">
              <div class="panel-heading d-inline-block float-left">
                Service Vessels
              </div>
              <div class="panel-body table-responsive pt-3">
                <table class="table table-striped">
                  <thead>
                    <tr>
                      <th>Vessel Name</th>
                      <th>Teu Capacity</th>
                      <th>Operator Name</th>
                      <th>IMO No.</th>
                      <th>Ownership Status</th>
                      <th>Move To</th>
                    </tr>
                  </thead>
                  <tbody>
                    <ng-container
                      *ngIf="
                        serviceObject.serviceVessels.ServiceVesselArray.length >
                          0;
                        else noDataBlock
                      "
                    >
                      <tr
                        class="table_row_1"
                        *ngFor="
                          let serviceVessel of serviceObject.serviceVessels
                            .ServiceVesselArray
                        "
                      >
                        <td>{{ serviceVessel.vessel_name }}</td>
                        <td>{{ serviceVessel.teu_capacity }}</td>
                        <td>{{ serviceVessel.operator_name }}</td>
                        <td>{{ serviceVessel.IMO_no }}</td>
                        <td>{{ serviceVessel.ownership_status }}</td>
                        <td>{{ serviceVessel.move_to_service }}</td>
                      </tr>
                    </ng-container>
                    <ng-template #noDataBlock>
                      <tr>
                        <td colspan="6" align="center">
                          You should choose at least a single vessel.
                        </td>
                      </tr>
                    </ng-template>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
          <div class="col-12 mt-2">
            <div class="panel panel-white h-100 service-classification-table">
              <div class="panel-heading d-inline-block float-left">
                Service Operators
              </div>
              <div class="panel-body table-responsive pt-3">
                <table class="table table-striped">
                  <thead>
                    <tr>
                      <th>Operator Name</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr
                      class="table_row_1"
                      *ngFor="
                        let serviceOperator of serviceObject.serviceOperators.serviceOperatorsArray
                      "
                    >
                      <td>{{ serviceOperator }}</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
          <div class="col-12 mt-2 text-center">
            <button
              class="btn btn-yellow text-uppercase fw-bold mr-2"
              type="submit"
            >
              SAVE
            </button>
            <button
              class="btn btn-yellow text-uppercase fw-bold mr-2"
              (click)="closeModal()"
              type="button"
            >
              BACK
            </button>
          </div>
        </div>
      </div>
    </div>
  </form>
</div>
